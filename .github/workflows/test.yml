name: ðŸšš Extra

on: 
  workflow_dispatch:
  # push:
  #   branches:
  #     - master
env:
  ROLE_NAME: ${{ vars.ROLE_NAME }}
jobs:
  setenv:
    runs-on: windows-latest
    outputs:
      service_env: ${{ steps.envmatrix.outputs.service_env }}
    steps:
      - name: ðŸ”¸ Output environment matrix
        id: envmatrix
        run: |
          echo "service_env=${{ vars.SERVICE_ENV_TEST }}" >> $env:GITHUB_OUTPUT
          echo "${{ env.ROLE_NAME }}"
  build:
    runs-on: windows-2022
    needs:
      - setenv
    strategy:
      fail-fast: false
      matrix:
        env: ${{ fromJSON(needs.setenv.outputs.service_env) }}
    environment: ${{ matrix.env }}
    env:
      ENV_NAME: ${{ vars.ENV_NAME }}
      ROLE_NAME: ${{ vars.ROLE_NAME }}
    steps:
      - uses: actions/checkout@v4
      - name: pwd
        run: |
          pwd
          ls -al
          echo "${{ env.ROLE_NAME }}"
      - name: build
        run: |
          pwd
          cd Docker
          docker build -t ${{ env.ENV_NAME }}:latest .
  # environ:
  #   needs: build
  #   runs-on: windows-latest
  #   environment: ${{ needs.build.outputs.channel }}
  #   env:
  #       ENV_NAME: ${{ vars.ENV_NAME }}
  #   steps:
  #   - name: echo
  #     run: |
  #       echo ${{ needs.build.outputs.channel }}
  #       echo "${{ env.ENV_NAME }}"
        